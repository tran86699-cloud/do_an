<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspbot V2 - AI Assistant</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <h1>ü§ñ RASPBOT V2 - AI ASSISTANT</h1>
        <p>AI-Powered Robot with Natural Language Control</p>
    </header>

    <!-- MAIN CONTAINER - 3 COLUMNS -->
    <div class="main-container">
        
        <!-- ============== LEFT PANEL: CONTROLS ============== -->
        <div class="panel left-panel">
            <h2>üéÆ CONTROLS</h2>
            
            <!-- MODE TABS -->
            <div class="mode-tabs">
                <button class="tab-btn active" onclick="setMode('manual')">Manual</button>
                <button class="tab-btn" onclick="setMode('auto')">Autonomous</button>
                <button class="tab-btn" onclick="setMode('ai')">üß† AI</button>
            </div>

            <!-- MANUAL MODE -->
            <div id="manual-mode" class="mode-content">
                <h3>Manual Control</h3>
                
                <!-- MOVEMENT BUTTONS -->
                <div class="button-section">
                    <button class="btn btn-forward" onclick="cmd('forward')">‚¨ÜÔ∏è FORWARD</button>
                    
                    <div class="row">
                        <button class="btn btn-left" onclick="cmd('left')">‚¨ÖÔ∏è LEFT</button>
                        <button class="btn btn-stop" onclick="cmd('stop')">‚èπ STOP</button>
                        <button class="btn btn-right" onclick="cmd('right')">‚û°Ô∏è RIGHT</button>
                    </div>
                    
                    <button class="btn btn-backward" onclick="cmd('backward')">‚¨áÔ∏è BACKWARD</button>
                    
                    <div class="row">
                        <button class="btn btn-rotate" onclick="cmd('rotate_left')">‚Ü∫ ROT L</button>
                        <button class="btn btn-rotate" onclick="cmd('rotate_right')">‚Üª ROT R</button>
                    </div>
                </div>

                <!-- SPEED -->
                <div class="control-group">
                    <label>Speed: <span id="speed-val">150</span></label>
                    <input type="range" min="50" max="255" value="150" oninput="setSpeed(this.value)">
                </div>

                <!-- CAMERA CONTROL -->
                <div class="control-group">
                    <label>Camera Pan: <span id="pan-val">90¬∞</span></label>
                    <div class="row">
                        <button class="btn-small" onclick="panCam(-10, 0)">‚óÄ</button>
                        <button class="btn-small" onclick="panCam(0, 0)">Reset</button>
                        <button class="btn-small" onclick="panCam(10, 0)">‚ñ∂</button>
                    </div>
                </div>

                <div class="control-group">
                    <label>Camera Tilt: <span id="tilt-val">45¬∞</span></label>
                    <div class="row">
                        <button class="btn-small" onclick="panCam(0, 10)">‚ñ≤</button>
                        <button class="btn-small" onclick="panCam(0, 0)">Reset</button>
                        <button class="btn-small" onclick="panCam(0, -10)">‚ñº</button>
                    </div>
                </div>

                <!-- KEYBOARD GUIDE -->
                <div class="keyboard-guide">
                    <strong>‚å®Ô∏è Keyboard:</strong>
                    <p>W/A/S/D = Move | Q/E = Rotate | SPACE = Stop</p>
                </div>
            </div>

            <!-- AUTONOMOUS MODE -->
            <div id="auto-mode" class="mode-content hidden">
                <h3>ü§ñ Autonomous Modes</h3>
                
                <div class="button-section">
                    <button class="btn btn-mode" onclick="startFindFace()" style="background:#a855f7;">
                        üîé FIND FACE<br><small style="font-size:10px;">Auto search & track</small>
                    </button>

                    <button class="btn btn-mode" onclick="startAutoObstacle()" style="background:#06b6d4;">
                        üö® AUTO OBSTACLE<br><small style="font-size:10px;">Auto navigate</small>
                    </button>

                    <button class="btn btn-mode" onclick="startFaceTracking()" style="background:#22c55e;">
                        üë§ FACE TRACKING<br><small style="font-size:10px;">Traditional tracking</small>
                    </button>

                    <button class="btn btn-stop" onclick="stopAutonomous()">
                        ‚èπÔ∏è STOP ALL
                    </button>
                </div>
            </div>

            <!-- AI MODE -->
            <div id="ai-mode" class="mode-content hidden">
                <h3>üß† AI-Assisted Control</h3>
                
                <!-- MODE 3 Info -->
                <div class="mode3-info">
                    <h3>ü§ñ AI Assistant</h3>
                    <p>Chat with your robot! I can answer questions AND execute commands.</p>
                    
                    <div class="mode3-examples">
                        <strong>üí° Try asking:</strong>
                        <code>"What can you do?"</code>
                        <code>"Go forward"</code>
                        <code>"Find a face"</code>
                        <code>"What's the distance?"</code>
                    </div>
                </div>

                <!-- PC Status -->
                <div class="ai-status" id="ai-connection-status">
                    <div class="status-dot"></div>
                    <span>PC Server: Checking...</span>
                </div>

                <!-- Quick Actions -->
                <div class="button-section">
                    <button class="btn btn-mode" onclick="aiQuickCommand('go forward')" style="background:#22c55e;">
                        ‚¨ÜÔ∏è GO FORWARD
                    </button>
                    <button class="btn btn-mode" onclick="aiQuickCommand('find face')" style="background:#a855f7;">
                        üîç FIND FACE
                    </button>
                    <button class="btn btn-stop" onclick="aiQuickCommand('stop')">
                        ‚èπ STOP
                    </button>
                </div>
            </div>
        </div>

        <!-- ============== CENTER PANEL: CAMERA & AI CHAT ============== -->
        <div class="panel center-panel">
            <!-- CAMERA -->
            <div class="camera-box">
                <img id="camera-feed" src="" alt="Camera Feed" style="width:100%; display:none;">
                <div id="camera-placeholder" class="camera-placeholder">
                    üì∑ Camera Feed<br><small>Connecting...</small>
                </div>
                <div class="camera-info">
                    <span>FPS: <strong id="fps">0</strong></span>
                    <span>Pan: <strong id="cam-pan">90¬∞</strong></span>
                    <span>Tilt: <strong id="cam-tilt">45¬∞</strong></span>
                </div>
            </div>

            <!-- AI CHAT - ONLY ONE! -->
            <div class="ai-chat-container" style="height: 250px; flex-shrink: 0;">
                <h3 style="color: #a855f7; margin-bottom: 10px;">üí¨ AI Assistant</h3>
                
                <div class="ai-messages" id="ai-messages">
                    <div class="ai-msg system">
                        üß† AI Assistant Active
                    </div>
                    <div class="ai-msg bot">
                        üëã Hello! I'm your robot AI assistant. You can ask me questions or give me commands! Try asking "What can you do?"
                    </div>
                </div>
                
                <div class="ai-input-group">
                    <input 
                        type="text" 
                        id="ai-input" 
                        placeholder="Ask me anything or give a command..." 
                        onkeypress="aiEnterCommand(event)"
                    >
                    <button class="ai-send-btn" onclick="sendAICommand()">
                        Send
                    </button>
                </div>
            </div>
        </div>

        <!-- ============== RIGHT PANEL: STATUS & SENSORS ============== -->
        <div class="panel right-panel">
            <h2>üìä STATUS</h2>
            
            <!-- CONNECTION STATUS -->
            <div class="status-panel">
                <div class="status-item">
                    <span>Connection:</span>
                    <span id="sse-status">üî¥ Offline</span>
                </div>
                <div class="status-item">
                    <span>Mode:</span>
                    <span id="robot-mode" style="color: #6b7280; font-weight: bold;">IDLE</span>
                </div>
                <div class="status-item" style="flex-direction: column; align-items: flex-start;">
                    <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 5px;">
                        <span>Speed:</span>
                        <span id="speed-value">0</span>
                    </div>
                    <div class="speed-bar-container" style="width: 100%;">
                        <div id="speed-bar"></div>
                    </div>
                </div>
                <div class="status-item">
                    <span>Last Cmd:</span>
                    <span id="last-command" style="color: #94a3b8;">none</span>
                </div>
                <div class="status-item" style="border-top: 1px solid #334155; padding-top: 10px; margin-top: 10px; flex-direction: column; align-items: flex-start;">
                    <div style="font-size: 0.9em; color: #94a3b8; margin-bottom: 5px;">Camera Position</div>
                    <div id="pan-value" style="font-size: 0.85em;">Pan: 90¬∞</div>
                    <div id="tilt-value" style="font-size: 0.85em;">Tilt: 45¬∞</div>
                </div>
            </div>

            <!-- AI SERVER STATUS (only in AI mode) -->
            <div id="mode3-status-panel" class="status-panel" style="display:none;">
                <h3 style="color: #a855f7; font-size: 13px; margin-bottom: 10px;">üß† AI SERVER</h3>
                <div class="status-item">
                    <span>PC Server:</span>
                    <span id="pc-server-status">-</span>
                </div>
                <div class="status-item">
                    <span>AI Model:</span>
                    <span id="ai-model-name" style="font-size: 11px;">-</span>
                </div>
                <div class="status-item">
                    <span>Commands:</span>
                    <span id="ai-commands-count">0</span>
                </div>
            </div>

            <!-- Line Sensors -->
            <div class="line-sensors-panel">
                <h3 style="margin-bottom: 10px;">Line Sensors</h3>
                <div style="display: flex; justify-content: space-around;">
                    <div class="sensor-indicator">
                        <div id="line-sensor-0" class="sensor-dot"></div>
                        <div>L1</div>
                    </div>
                    <div class="sensor-indicator">
                        <div id="line-sensor-1" class="sensor-dot"></div>
                        <div>L2</div>
                    </div>
                    <div class="sensor-indicator">
                        <div id="line-sensor-2" class="sensor-dot"></div>
                        <div>R1</div>
                    </div>
                    <div class="sensor-indicator">
                        <div id="line-sensor-3" class="sensor-dot"></div>
                        <div>R2</div>
                    </div>
                </div>
            </div>

            <!-- DISTANCE GAUGE -->
            <div class="status-group">
                <h3>üìè Distance (Real-time)</h3>
                <div style="background:#0f172a; padding:15px; border-radius:4px; text-align:center;">
                    <div style="font-size:32px; font-weight:bold; color:#0ea5e9; margin-bottom:10px;">
                        <span id="dist-result">-</span><span style="font-size:20px;">cm</span>
                    </div>
                    <div style="background:#1e293b; border-radius:4px; overflow:hidden; height:20px; margin-bottom:8px;">
                        <div id="dist-bar" style="background:linear-gradient(90deg, #ef4444, #f59e0b, #22c55e); height:100%; width:0%; transition:width 0.3s;"></div>
                    </div>
                    <div style="font-size:11px; color:#64748b; display:flex; justify-content:space-between;">
                        <span>0cm</span>
                        <span>100cm</span>
                    </div>
                    <div style="margin-top:10px; padding:8px; background:#1e293b; border-radius:4px; font-size:12px;">
                        <span id="dist-status">‚è≥ Connecting...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>